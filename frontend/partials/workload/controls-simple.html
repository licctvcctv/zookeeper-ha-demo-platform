<section class="panel">
  <h2>负载演示工具</h2>
  <p class="muted">一键生成测试负载，观察调度器如何在三个节点之间迁移文件以保持负载均衡。</p>

  <div class="grid two" style="max-width: 800px; margin: 1.5rem auto;">
    <article class="card">
      <h3 style="margin-top:0;">批量生成负载</h3>
      <p class="muted" style="font-size: 0.9rem; margin-bottom: 1rem;">
        自动生成 50 个测试文件（每个 100-500KB），智能分配到各节点
      </p>
      <div class="control-actions">
        <button
          @click="quickGenerateLoad"
          class="primary"
          :disabled="bulkLoading"
          style="width: 100%; padding: 0.8rem 1.5rem; font-size: 1rem;"
        >
          <span v-if="bulkLoading" style="display: inline-flex; align-items: center; gap: 0.5rem;">
            <span class="spinner"></span>
            {{ bulkProgressText || '生成中…' }}
          </span>
          <span v-else>一键生成测试负载</span>
        </button>
      </div>

      <!-- 进度条 -->
      <div v-if="bulkLoading" class="progress-container" style="margin-top: 1rem;">
        <div class="progress-bar" style="height: 8px; background: var(--bg-soft); border-radius: 4px; overflow: hidden;">
          <div
            class="progress-fill"
            :style="{
              width: bulkProgress + '%',
              height: '100%',
              background: 'linear-gradient(90deg, #3b82f6, #8b5cf6)',
              transition: 'width 0.3s ease'
            }"
          ></div>
        </div>
        <p class="progress-text" style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-muted); text-align: center;">
          {{ bulkProgressText }}
        </p>
      </div>

      <p v-if="bulkMessage && !bulkLoading" class="muted" style="margin-top:0.75rem;">{{ bulkMessage }}</p>
    </article>

    <article class="card">
      <h3 style="margin-top:0;">调度器控制</h3>
      <p class="muted" style="font-size: 0.9rem; margin-bottom: 1rem;">
        手动触发调度器，重新平衡各节点的文件分布
      </p>
      <div class="control-actions">
        <button
          @click="runScheduler"
          :disabled="schedulerRunning"
          style="width: 100%; padding: 0.8rem 1.5rem; font-size: 1rem;"
        >
          <span v-if="schedulerRunning" style="display: inline-flex; align-items: center; gap: 0.5rem;">
            <span class="spinner"></span>
            {{ schedulerProgressText || '调度中…' }}
          </span>
          <span v-else>手动执行调度</span>
        </button>
      </div>

      <!-- 调度进度条 -->
      <div v-if="schedulerRunning" class="progress-container" style="margin-top: 1rem;">
        <div class="progress-bar" style="height: 8px; background: var(--bg-soft); border-radius: 4px; overflow: hidden;">
          <div
            class="progress-fill"
            :style="{
              width: schedulerProgress + '%',
              height: '100%',
              background: 'linear-gradient(90deg, #10b981, #06b6d4)',
              transition: 'width 0.3s ease'
            }"
          ></div>
        </div>
        <p class="progress-text" style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-muted); text-align: center;">
          {{ schedulerProgressText }}
        </p>
      </div>

      <div class="notice" style="margin-top:1rem; font-size: 0.85rem;">
        <strong>调度阈值：</strong>{{ schedulerInfo.threshold }} 个文件
        <span style="margin-left: 0.5rem;">｜</span>
        <strong style="margin-left: 0.5rem;">当前差异：</strong>
        <span :style="{ color: schedulerInfo.delta >= schedulerInfo.threshold ? '#f59e0b' : '#10b981', fontWeight: 'bold' }">
          {{ schedulerInfo.delta }}
        </span>
      </div>
    </article>
  </div>

  <p class="muted" style="text-align: center; margin-top: 1rem;">{{ schedulerMessage }}</p>
</section>

