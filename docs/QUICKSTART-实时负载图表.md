# 🚀 实时负载图表快速使用指南

## 启动系统

```bash
# 1. 启动 ZooKeeper 集群
docker-compose up -d

# 2. 启动后端服务
cd backend
uvicorn app.main:app --host 0.0.0.0 --port 8080

# 3. 访问前端
浏览器打开：http://localhost:8080/ui/
```

## 🎯 快速体验实时负载图表

### 第一步：查看初始状态
打开 http://localhost:8080/ui/overview.html

你会看到：
- ✨ 3个彩色统计卡片（总任务数、运行中、已完成）
- 📊 任务分布饼图（按节点）
- 📊 文件分布柱状图（各节点负载）
- 📋 节点负载概览卡片
- 🔍 集群节点详情

### 第二步：创建负载
打开 http://localhost:8080/ui/workload.html

**方法1️⃣：使用热点制造功能（推荐）**
```
1. 找到"热点制造"卡片
2. 选择目标节点：zk1
3. 文件数量：20
4. 单个大小：256 KB
5. ✅ 勾选"生成后立即调度"
6. 点击"生成热点文件"
```

**立即观察：**
- 📈 "调度统计概览"中的图表实时更新
- 🔴 "任务状态分布图"显示新任务
- 📊 "节点任务分布图"显示负载变化
- 🎯 "实时负载监控"中的"当前差异"数字变化
- ⏱️ "调度与操作历史"时间线出现新记录

### 第三步：观察调度过程

**自动调度：**
系统会自动检测负载不均衡（差异≥3）并触发调度

**手动调度：**
1. 在"批量上传演示"区域点击"手动执行调度"
2. 观察：
   - 📊 文件分布图表变化
   - 🔄 调度快照回放（3列对比：操作前、操作后、调度后）
   - ⏱️ 时间线新增调度记录

### 第四步：持续监控

**切换回 overview.html**
- 每 5 秒自动刷新
- 观察任务状态的变化
- 查看节点间负载的平衡过程

## 📊 图表说明

### Overview 页面图表

| 图表名称 | 类型 | 更新频率 | 作用 |
|---------|------|----------|------|
| 任务分布图 | 饼图 | 5秒 | 显示各节点任务分配 |
| 文件分布图 | 柱状图 | 5秒 | 显示各节点文件负载 |
| 系统状态卡片 | 统计卡 | 5秒 | 快速了解系统状态 |

### Workload 页面图表

| 图表名称 | 类型 | 更新频率 | 作用 |
|---------|------|----------|------|
| 任务状态分布图 | 饼图 | 8秒 | 显示任务状态分布 |
| 节点任务分布图 | 柱状图 | 8秒 | 显示节点任务负载 |
| 实时负载监控 | 统计卡 | 8秒 | 监控调度阈值和差异 |
| 文件分布图 | 柱状图 | 8秒 | 显示文件负载分布 |

## 🎨 界面亮点

### 1. 彩色状态徽章
```
🔵 queued    - 排队中（蓝色）
🟡 running   - 运行中（黄色，有脉动动画）
🟢 succeeded - 已成功（绿色）
🔴 failed    - 已失败（红色）
⚪ cancelled - 已取消（灰色）
```

### 2. 渐变统计卡片
- 📊 Info（蓝紫渐变）
- ✅ Success（绿色渐变）
- ⚠️ Warning（橙色渐变）

### 3. 操作历史时间线
- 左侧竖线连接所有操作
- 每个操作有独立卡片
- 成功/失败操作有不同的点颜色
- 显示时间戳和详细信息

### 4. 动态颜色编码
当前差异 < 阈值：🟢 绿色（平衡）
当前差异 ≥ 阈值：🟠 橙色（需要调度）

## 💡 使用技巧

### 技巧 1：批量创建负载观察自动调度
```
1. 模式选择"集中到指定节点"
2. 选择 zk1
3. 数量设为 30
4. 勾选"上传后立即调度"
5. 点击"批量上传"
6. 观察调度快照的三列对比
```

### 技巧 2：制造热点并手动控制
```
1. 使用热点制造生成文件到 zk2
2. 不勾选自动调度
3. 观察"当前差异"数字变化
4. 手动点击"手动执行调度"
5. 查看操作历史时间线
```

### 技巧 3：多节点对比
```
1. 分别向 zk1、zk2、zk3 各生成 5 个文件
2. 观察文件分布柱状图
3. 观察节点任务分布图
4. 对比各节点的负载情况
```

## 🔍 数据解读

### 判断系统是否平衡
✅ 良好状态：
- 当前差异 < 3
- 文件分布柱状图高度接近
- 任务均匀分布在各节点

⚠️ 需要关注：
- 当前差异 ≥ 3（橙色显示）
- 某个节点柱状图明显更高
- 某节点任务过多

### 判断调度是否生效
✅ 调度成功标志：
- 操作历史出现"自动调度"记录
- 调度快照显示"调度后"文件数变化
- 当前差异数值减小
- 文件分布图变得更均衡

## ⚡ 性能说明

- 图表使用 Canvas 渲染，流畅度高
- 自动节流机制，避免过度刷新
- 空数据时不渲染图表内容
- 响应式设计，适配各种屏幕

## 📝 常见问题

**Q: 图表不更新？**
A: 检查后端服务是否运行，打开浏览器控制台查看是否有 API 错误

**Q: 图表显示空白？**
A: 可能是数据还未生成，等待几秒让系统自动生成演示数据

**Q: 想加快数据生成速度？**
A: 使用"批量上传"或"热点制造"功能快速创建数据

**Q: 如何清空数据重新演示？**
A: 重启后端服务会重置数据库，或者删除 `data/demo.db` 文件

## 🎬 完整演示流程（5分钟）

```
时间  | 操作                           | 观察点
------|-------------------------------|----------------------------------
0:00  | 打开 overview.html            | 查看初始状态
0:30  | 切换到 workload.html          | 了解页面布局
1:00  | 创建热点：zk1, 20个文件       | 图表实时更新
1:30  | 观察调度统计概览              | 任务状态分布图变化
2:00  | 查看操作历史时间线            | 新增多条记录
2:30  | 创建热点：zk2, 15个文件       | 再次观察负载变化
3:00  | 点击"手动执行调度"            | 查看调度快照对比
3:30  | 切回 overview.html            | 观察整体平衡效果
4:00  | 等待自动生成任务              | 任务分布图变化
4:30  | 查看 Grafana 集成面板         | 对比多种监控视图
5:00  | 演示完成                      | 总结展示的功能
```

## 🚀 开始体验

现在就启动系统，按照上述步骤体验实时负载图表功能吧！

祝使用愉快！ 🎉
